#!/bin/bash
#
# yaml2markdown
#
# Usage: ./bin/yaml2markdown.sh
#
# Required packages:
# * https://github.com/kislyuk/yq
#

# === dir paths
rootDir="$(cd `dirname $0` && dirname "$(pwd)")"
binDir="$rootDir/bin"
srcDir="$rootDir/src"
distDir="$rootDir/dist"

# === Generate json dist
bash $binDir/yaml2json.sh

# === Generate README
readme=$rootDir/README.md
rm $readme

# == Add disclaimer
echo -e "<!--This file is automatically generated from yaml2markdown.sh -->\n\n" > $readme
cat $rootDir/README_TEMPLATE.md >> $readme

# == Create project list
projectsReadme="$(python $binDir/generateReadme.py)"

# == Create ToC
tempProjectsFile="$rootDir/tmp_projects.md"
echo "$projectsReadme" > $tempProjectsFile

toc="$($binDir/gh-md-toc $tempProjectsFile)"

rm $tempProjectsFile

# == Insert project list and ToC into file
tmpReadme="${readme}.tmp"

awk -v PROJECTS="$projectsReadme" -v TABLE_OF_CONTENTS="$toc" '{
  sub(/<AWESOME_LIST>/, PROJECTS);
  sub(/<TOC>/, TABLE_OF_CONTENTS);
  print;
}' $readme > $tmpReadme
mv $tmpReadme $readme

